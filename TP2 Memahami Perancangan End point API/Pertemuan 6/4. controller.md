# Controller Laravel - Panduan Lengkap

## Apa itu Controller?
Controller adalah komponen dalam arsitektur MVC (Model–View–Controller) yang bertanggung jawab menerima request dari router, memproses logika aplikasi (biasanya berinteraksi dengan Model), dan mengembalikan response (View atau JSON). Controller memisahkan logika dari rute sehingga kode lebih terstruktur dan mudah diuji.

---

## 1. Lokasi dan Penamaan

Controller disimpan di direktori `app/Http/Controllers`.

Konvensi penamaan:
- Gunakan PascalCase dan akhiri dengan `Controller`, misal `UserController`.
- Untuk API, sering di tempatkan dalm folder `App\Http\Controllers\Api`.

Membuat controller dengan artisan:

```bash
php artisan make:controller UserController
```

Membuat Controller resource (include methods index, create, store, show, edit, update, destroy)
```bash
php artisan make:controller UserController --resource
```

Membuat Controller API (miri seperti resource tapi tanpa `create` dan `edit`)
```bash
php artisan make:controller Api/UserController --api
```
---

## 2. Struktur Dasar Controller

Contoh controller sederhana:

```php
namespace App\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Http\Request;

class UserController extends Controller
{
    public function index()
    {
        $users = User::all();
        return view('users.index', compact('users'));
    }

    public function show($id)
    {
        $user = User::findOrFail($id);
        return view('users.show', compact('user'));
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|email|unique:users',
        ]);

        $user = User::create($validated);

        return redirect()->route('users.show', $user->id);
    }
}
```

---

## 3. Resource Controllers (RESTful)

Resource controller menyediakan 7 method standar untuk operasi CRUD:

- `index()`   → menampilkan daftar resource
- `create()`  → menampilkan form pembuatan (web)
- `store()`   → menyimpan resource baru
- `show()`    → menampilkan single resource
- `edit()`    → menampilkan form edit (web)
- `update()`  → memperbarui resource
- `destroy()` → menghapus resource

Mendaftarkan resource route:

```php
Route::resource('users', UserController::class);
```

Untuk API-only (tanpa `create` dan `edit`):

```php
Route::apiResource('users', Api\UserController::class);
```

---

## 4. Single Action Controllers

Jika controller hanya memiliki satu action, gunakan `__invoke`:

```php
class SubscribeController extends Controller
{
    public function __invoke(Request $request)
    {
        // handle subscription
    }
}

// route
Route::post('/subscribe', SubscribeController::class);
```

---

## 5. Dependency Injection

Laravel mendukung dependency injection di constructor dan method controller.

```php
use App\Services\ReportService;

class ReportController extends Controller
{
    protected $reportService;

    public function __construct(ReportService $reportService)
    {
        $this->reportService = $reportService;
    }

    public function index()
    {
        $data = $this->reportService->generate();
        return view('reports.index', compact('data'));
    }
}
```

---

## 6. Middleware di Controller

Anda bisa menerapkan middleware pada controller dengan `middleware()` di constructor:

```php
class AdminController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
        $this->middleware('can:manage-users')->only(['destroy']);
    }
}
```

Atau pada route group:

```php
Route::middleware(['auth', 'admin'])->group(function () {
    Route::resource('users', UserController::class);
});
```

---

## 7. Form Request Validation

Untuk menjaga controller tetap bersih, gunakan Form Request classes:

```bash
php artisan make:request StoreUserRequest
```

Contoh penggunaan:

```php
use App\Http\Requests\StoreUserRequest;

class UserController extends Controller
{
    public function store(StoreUserRequest $request)
    {
        $data = $request->validated();
        $user = User::create($data);
        return redirect()->route('users.show', $user);
    }
}
```

Form Request berisi aturan validasi (`rules()`), otorisasi (`authorize()`), dan dapat memodifikasi input sebelum validasi (`prepareForValidation()`).

---

## 8. Resource Collections & API Responses

Untuk API, gunakan Resource classes untuk memformat response:

```bash
php artisan make:resource UserResource
```

Contoh:

```php
use App\Http\Resources\UserResource;

public function show(User $user)
{
    return new UserResource($user);
}

public function index()
{
    return UserResource::collection(User::paginate(10));
}
```

---

## 9. Tips Organisasi Controller

- Pisahkan controller API dan Web (`App\Http\Controllers\Api`).
- Jika method controller terlalu panjang, ekstrak logika ke Service atau Action class.
- Gunakan Resource Controllers untuk konsistensi CRUD.
- Hindari logika bisnis besar di controller — letakkan di Model atau Service.

---

## 10. Contoh Lengkap: CRUD sederhana

```php
namespace App\Http\Controllers;

use App\Models\Post;
use App\Http\Requests\StorePostRequest;

class PostController extends Controller
{
    public function index()
    {
        $posts = Post::latest()->paginate(10);
        return view('posts.index', compact('posts'));
    }

    public function create()
    {
        return view('posts.create');
    }

    public function store(StorePostRequest $request)
    {
        $post = Post::create($request->validated());
        return redirect()->route('posts.show', $post);
    }

    public function show(Post $post)
    {
        return view('posts.show', compact('post'));
    }

    public function edit(Post $post)
    {
        return view('posts.edit', compact('post'));
    }

    public function update(StorePostRequest $request, Post $post)
    {
        $post->update($request->validated());
        return redirect()->route('posts.show', $post);
    }

    public function destroy(Post $post)
    {
        $post->delete();
        return redirect()->route('posts.index');
    }
}
```

---

## 11. Debugging dan Testing

- Gunakan `dd()` atau `dump()` untuk debug cepat.
- Unit test controller dengan HTTP tests:

```php
public function test_index_shows_posts()
{
    $post = Post::factory()->create();

    $this->get(route('posts.index'))
         ->assertStatus(200)
         ->assertSee($post->title);
}
```

- Jalankan test dengan `php artisan test`.

---

## Kesimpulan
Controller adalah penghubung antara request (router) dan lapisan bisnis/data (model). Gunakan resource controller, Form Request, dan service classes untuk menjaga controller tetap ringkas dan terstruktur.
