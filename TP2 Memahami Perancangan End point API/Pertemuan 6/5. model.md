# Model Laravel - Panduan Lengkap

## Apa itu Model?

Model adalah representasi dari tabel database dalam bentuk class PHP. Dalam arsitektur MVC, Model bertanggung jawab untuk mengelola data dan logika bisnis yang terkait dengan data tersebut. Laravel menggunakan **Eloquent ORM** (Object-Relational Mapping) yang membuat interaksi dengan database menjadi intuitif dan mudah.

---

## 1. Membuat Model

### Menggunakan Artisan Command

```bash
# Model sederhana
php artisan make:model Post

# Model dengan migration
php artisan make:model Post --migration
php artisan make:model Post -m

# Model dengan factory dan seeder
php artisan make:model Post -mfs

# Model dengan controller
php artisan make:model Post --controller
php artisan make:model Post -c

# Semua bersamaan
php artisan make:model Post -mfsc
```

### Lokasi Default
Semua model tersimpan di `app/Models/`.

---

## 2. Struktur Dasar Model

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class Post extends Model
{
    use HasFactory;

    /**
     * Nama tabel pada database
     * Jika tidak didefinisikan, Laravel otomatis menggunakan plural
     * dari nama class (Post → posts)
     */
    protected $table = 'posts';

    /**
     * Primary key dari model
     * Default adalah 'id'
     */
    protected $primaryKey = 'id';

    /**
     * Tipe data primary key
     * Default adalah 'int'
     */
    protected $keyType = 'string';

    /**
     * Tentukan apakah primary key auto-increment
     * Default adalah true
     */
    public $incrementing = true;

    /**
     * Column-column yang dapat di-assign secara massal
     * (Mass Assignment Protection)
     */
    protected $fillable = [
        'title',
        'content',
        'author_id',
        'published_at'
    ];

    /**
     * Column-column yang TIDAK boleh di-assign (blacklist)
     */
    protected $guarded = ['id'];

    /**
     * Timestamps otomatis (created_at, updated_at)
     * Default adalah true
     */
    public $timestamps = true;

    /**
     * Format tanggal
     */
    protected $dateFormat = 'Y-m-d H:i:s';

    /**
     * Atribut yang disembunyikan saat di-serialize
     * Berguna untuk password, token, dll
     */
    protected $hidden = ['password'];

    /**
     * Casting tipe data
     */
    protected $casts = [
        'published_at' => 'datetime',
        'is_published' => 'boolean',
        'views' => 'integer',
        'metadata' => 'json',
    ];
}
```

---

## 3. Query Dasar dengan Eloquent

### Read (Pengambilan Data)

```php
use App\Models\Post;

// Mengambil semua records
$posts = Post::all();

// Mengambil dengan kondisi
$published = Post::where('is_published', true)->get();

// Mengambil satu record
$post = Post::find(1);  // Berdasarkan primary key

// Mengambil dengan kondisi, satu record
$post = Post::where('slug', 'hello-world')->first();

// Mengambil dengan kondisi, atau error 404
$post = Post::findOrFail(1);
$post = Post::where('slug', 'hello-world')->firstOrFail();

// Mengambil value dari single column
$titles = Post::pluck('title');

// Count
$count = Post::count();

// Paginate
$posts = Post::paginate(15);

// Chaining query
$posts = Post::where('is_published', true)
    ->orderBy('created_at', 'desc')
    ->limit(10)
    ->get();
```

### Create (Membuat Data)

```php
// Method 1: Langsung assign
$post = new Post();
$post->title = 'Hello World';
$post->content = 'Lorem ipsum dolor sit amet';
$post->save();

// Method 2: Mass Assignment
$post = Post::create([
    'title' => 'Hello World',
    'content' => 'Lorem ipsum dolor sit amet',
    'author_id' => 1
]);

// Method 3: firstOrCreate
// Cari berdasarkan kondisi, jika tidak ada maka buat
$post = Post::firstOrCreate(
    ['slug' => 'hello-world'],  // kondisi pencarian
    ['title' => 'Hello World']  // data jika create
);

// Method 4: updateOrCreate
$post = Post::updateOrCreate(
    ['slug' => 'hello-world'],
    ['title' => 'Hello World Updated']
);
```

### Update (Memperbarui Data)

```php
// Method 1: Find dan update
$post = Post::find(1);
$post->title = 'New Title';
$post->save();

// Method 2: Update langsung
Post::where('author_id', 1)->update([
    'title' => 'Updated Title'
]);

// Method 3: Increment/Decrement
Post::find(1)->increment('views');              // views + 1
Post::find(1)->increment('views', 5);           // views + 5
Post::find(1)->decrement('views');              // views - 1
```

### Delete (Menghapus Data)

```php
// Method 1: Delete instance
$post = Post::find(1);
$post->delete();

// Method 2: Delete langsung
Post::destroy(1);                     // Delete by ID
Post::destroy([1, 2, 3]);            // Delete multiple IDs

// Method 3: Delete dengan kondisi
Post::where('author_id', 1)->delete();

// Soft Delete (hanya menandai deleted_at)
// Requires: use SoftDeletes trait
$post->delete();                      // Mark as deleted
$post->restore();                     // Restore
$post->forceDelete();                 // Hard delete
Post::withTrashed()->get();           // Include soft deleted
Post::onlyTrashed()->get();           // Only soft deleted
```

---

## 4. Relationships (Relasi)

### One-to-Many

```php
// Model Post
class Post extends Model
{
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }
}

// Model Comment
class Comment extends Model
{
    public function post()
    {
        return $this->belongsTo(Post::class);
    }
}

// Penggunaan
$post = Post::find(1);
$comments = $post->comments;
$postTitle = $comment->post->title;
```

### One-to-One

```php
class User extends Model
{
    public function profile()
    {
        return $this->hasOne(Profile::class);
    }
}

class Profile extends Model
{
    public function user()
    {
        return $this->belongsTo(User::class);
    }
}
```

### Many-to-Many

```php
class Post extends Model
{
    public function tags()
    {
        return $this->belongsToMany(Tag::class);
    }
}

class Tag extends Model
{
    public function posts()
    {
        return $this->belongsToMany(Post::class);
    }
}

// Penggunaan
$post->tags()->attach($tagId);        // Attach tag
$post->tags()->detach($tagId);        // Detach tag
$post->tags()->sync([1, 2, 3]);       // Sync (replace)
$post->tags;                          // Get all tags
```

### Polymorphic Relationships

```php
class Comment extends Model
{
    public function commentable()
    {
        return $this->morphTo();
    }
}

class Post extends Model
{
    public function comments()
    {
        return $this->morphMany(Comment::class, 'commentable');
    }
}

// Penggunaan: Comment bisa belong ke Post, Video, atau Article
$comment->commentable;  // Post/Video/Article instance
```

---

## 5. Eager Loading (Optimisasi Query)

Hindari N+1 Query Problem dengan eager loading:

```php
// ❌ N+1 Query Problem
$posts = Post::all();
foreach ($posts as $post) {
    echo $post->author->name;  // Query untuk setiap post
}

// ✅ Eager Loading
$posts = Post::with('author', 'comments')->get();
foreach ($posts as $post) {
    echo $post->author->name;  // Sudah di-load
}

// Nested eager loading
$posts = Post::with('author', 'comments.author')->get();

// Conditional loading
$posts = Post::with(['comments' => function($query) {
    $query->where('approved', true)->latest();
}])->get();
```

---
     

## 9. Contoh Lengkap: Model Post

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;

class Post extends Model
{
    use HasFactory, SoftDeletes;

    protected $fillable = ['title', 'content', 'author_id', 'published_at'];
    
    protected $casts = [
        'published_at' => 'datetime',
        'is_published' => 'boolean',
    ];

    protected $hidden = ['deleted_at'];

    // Scopes
    public function scopePublished($query)
    {
        return $query->where('is_published', true);
    }

    public function scopeLatest($query)
    {
        return $query->orderBy('created_at', 'desc');
    }

    // Relationships
    public function author()
    {
        return $this->belongsTo(User::class);
    }

    public function comments()
    {
        return $this->hasMany(Comment::class);
    }

    public function tags()
    {
        return $this->belongsToMany(Tag::class);
    }

    // Events
    protected static function booted()
    {
        static::creating(function ($model) {
            $model->slug = str_slug($model->title);
        });
    }
}
```

---

## 10. Praktik Terbaik

✅ **DO's:**
- Gunakan `fillable` untuk mass assignment security
- Implement Eager Loading untuk query optimization
- Gunakan Scopes untuk reusable query logic
- Cast atribut ke tipe yang sesuai
- Gunakan Events untuk logic yang perlu triggered

❌ **DON'Ts:**
- Jangan menggunakan `guarded = ['*']` tanpa berhati-hati
- Jangan lupa eager loading untuk relasi
- Jangan simpan password atau data sensitif tanpa encryption
- Jangan gunakan `all()` untuk dataset besar
- Jangan lakukan query di event booting tanpa cache

---

## 11. Debugging Model

```bash
# Tinker interactive shell
php artisan tinker

# Di tinker
$post = App\Models\Post::find(1);
$post->toArray();
$post->toJson();
$post->getAttributes();
```

---

## Kesimpulan

Model adalah jantung dari aplikasi Laravel. Dengan memahami Eloquent ORM, kamu dapat menulis kode database yang elegan, aman, dan mudah dimaintain. Kombinasikan Model dengan Router dan Controller untuk membuat aplikasi yang terstruktur dengan baik.
