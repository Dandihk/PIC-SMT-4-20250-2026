# CRUD Laravel API: Todo List (backend)

## Tujuan
Membuat API CRUD untuk Todo List dengan relasi ke tabel Kategori menggunakan Laravel.

**Prasyarat:**
- PHP 
- Composer
- MySQL dan `.env` terkonfigurasi
- Laravel = 12.0
- install [extension postman](https://dl.pstmn.io/download/latest/win64)
- buat akun postman dengan gmail
---
pahami erd berikut
terdapat 2 tabel saling berelasi

![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/todo_erd.png)

---

### 1. buka project laravel di vscode
jalankan diterminal install api untuk menggunakan template api
```bash
php artisan install:api
```
## 2. buat model todo dan kategori
```bash
php artisan make:model tb_kategori -mf   

php artisan make:model tb_todo -mf     
```
## 3. buat struktur tabel kategori dan todo
migration kategori
```php
            $table->id();
            $table->string('nama_kategori');
            $table->string('deskripsi')->nullable();
            $table->timestamps();
```
migration todo
```php
            $table->id();
            $table->string('judul');
            $table->foreignId('kategori_id')->constrained('tb_kategoris');
            $table->text('deskripsi')->nullable();
            $table->boolean('status')->default(0);
            $table->timestamps();
```
## 4. buat ketentuan modelnya dan relasi
model kategori
```php
    protected $fillable = ['nama_kategori','deskripsi'];

    public function todos() //<function untuk relasi dari kategori banyak  ke todo 1
    {
        return $this->hasMany(tb_todo::class, 'kategori_id');
    }
```
model todo
```php
    use HasFactory;
    protected $fillable = ['judul', 'kategori_id', 'deskripsi', 'status'];

    public function kategori() //<function untuk relasi dari todo 1 ke kategori banyak
    {
        return $this->belongsTo(tb_kategori::class, 'kategori_id');
    }
```

## 5. Jalankan Migration untuk memasukan data ke database
```bash
php artisan migrate      
```
**cek tabel di phpmyadmin apakah sudah terbuat atau belum**

## 6. Buat Controller todo dan kategori
karena kita bertujuan membuat backend saja maka gunakan controller khusus api, penempatan controller juga berbeda yaitu di folder api/..controler
```bash
php artisan make:controller Api/TodoController --api   

php artisan make:controller Api/KategoriController --api  
```
controller akan berisi function sesuai aturan api 

## 7. Buat route todo dan kategori
untukroute api amaka penempatannya beda dari route biasanya ya itu di taruh dalam routes/api.php
```bash
Route::apiResource('kategori', KategoriController::class);
Route::apiResource('todo', TodoController::class);
```
pemanggilan route harus sesuai dengan aturan route
 contoh : 
 ```php
// Otomatis membuat 7 routes CRUD
Route::resource('users', 'UserController');

// Menghasilkan:
// GET    /users                 → index
// POST   /users                 → store
// GET    /users/create          → create
// GET    /users/{id}            → show
// GET    /users/{id}/edit       → edit
// PUT    /users/{id}            → update
// DELETE /users/{id}            → destroy
```
## 7. Membuat Create data kategori di controller kategori
 indek digunakan untuk menampilkan semua data 
```php
public function index()
    {
        $kategoris = tb_kategori::all(); // untuk memanggil semua isi tb_kategori
        return response()->json(['success' => true, 'data' => $kategoris], 200); //< sespon dari api ketika pemanggilan sukses dan data ditampilkan berupa json
    }
```
buat request get di postman dan panggil sesuai routenya 
![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/get.png)

## 8. Membuat post data kategori di controller kategori
 store digunakan untuk mengirim data ke api 
```php
public function store(Request $request) //mempunyai parameter request yang berisi inputan data
    {
        //gunakan validator untuk verivikasi data agar sesuai yang dinginkan
        $validator = Validator::make($request->all(), [  
            'nama_kategori' => 'required|string|max:255',
            'deskripsi' => 'nullable|string'
        ]);
        //jika fail akan menampilkan error 422
        if ($validator->fails()) {
            return response()->json($validator->errors(), 422);
        }
        //jika data sesuai akan dipost ke dalam model dan menampilkan sukses
        $kategori = tb_kategori::create($request->all());
        return response()->json(['success' => true, 'data' => $kategori], 201);

    }
```
validator mengharuskan untuk menggunakan library jadi harus di use
```php
use Illuminate\Support\Facades\Validator;
```

buat request post di postman dan panggil sesuai routenya dan masukan data pilih form data isi sesuai colum yang boleh di isi
![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/psot.png)


## 9. Membuat lihat data kategori satu persatu di controller kategori
show digunakan untuk lihat data satu persatu data
```php
public function show(string $id) //mempunyai parameter id yang berisi id data
    {
        $kategori = tb_kategori::find($id); //<akan mencari id di tabel dengan paramater id
        if (!$kategori) return response()->json(['message' => 'Data tidak ditemukan'], 404); //<jika tidak ada maka error notfound

        return response()->json(['success' => true, 'data' => $kategori], 200); //<jika ada maka sukses dan data ditampilkan
    }
```

buat request get di postman dan panggil sesuai routenya dan data yang di cari

![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/show.png)

## 10. Membuat update data kategori di controller kategori
 update digunakan untuk mengupdate data ke api 
```php
public function update(Request $request, string $id) //mempunyai parameter request yang berisi inputan data dan id
    {
        //gunakan validator untuk verivikasi data agar sesuai yang dinginkan
        $validator = Validator::make($request->all(), [
            'nama_kategori' => 'required|string|max:255',
            'deskripsi' => 'nullable|string'
        ]);
        //jika fail akan menampilkan error 422
        if ($validator->fails()) {
            return response()->json($validator->errors(), 422);
        }
        //mencaria data sesuai parameter id 
        $kategori = tb_kategori::find($id);
        if (!$kategori) return response()->json(['message' => 'Data tidak ditemukan'], 404);
        // jika berhasil dicari data akan diupdate dengan parameter request
        $kategori->update($request->all());
        return response()->json(['success' => true, 'data' => $kategori], 200);
    }
```
buat request put di postman dan panggil sesuai routenya dan id yang diedit dan masukan data pilih form data isi sesuai colum yang boleh di isi
![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/update.png)

## 10. Membuat delete data kategori di controller kategori
 destroy digunakan untuk menghapus data ke api 
```php
public function destroy(string $id) //mempunyai parameter id yang berisi id data 
    {
        //mencaria data sesuai parameter id  
        $kategori = tb_kategori::find($id);
        if (!$kategori) return response()->json(['message' => 'Data tidak ditemukan'], 404);
        //jika datanya sesuai akan didelete
        $kategori->delete();
        return response()->json(['success' => true, 'message' => 'Berhasil dihapus'], 200);
    }
```
buat request delete di postman dan panggil sesuai routenya dan id yang dihapus
![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/delete.png)

## 11. JALANKAN SERVER

```bash
php artisan serve
```
Server akan berjalan di `http://localhost:8000`

---

