# CRUD Laravel API: Todo List dengan Kategori

## Tujuan
Membuat API CRUD lengkap untuk Todo List dengan relasi ke tabel Kategori menggunakan Laravel.

**Prasyarat:**
- PHP >= 8.0
- Composer
- MySQL / PostgreSQL dan `.env` terkonfigurasi
- Laravel >= 8.0

---
![alt text](/TP2%20Memahami%20Perancangan%20End%20point%20API/Pertemuan%207/Media/todo_erd.png)

---

## 1. QUICK START

### Setup Project Baru

```bash
composer create-project laravel/laravel todo-app
cd todo-app
php artisan key:generate
```

### Konfigurasi Database

Edit `.env`:

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=todo_app
DB_USERNAME=root
DB_PASSWORD=
```

Buat database:

```bash
mysql -u root -e "CREATE DATABASE todo_app;"
```

---

## 2. MIGRATIONS - Struktur Tabel

### 2.1 Migration Categories

**File: `database/migrations/2025_02_22_000001_create_categories_table.php`**

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('categories', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('categories');
    }
};
```

**Perintah untuk membuat:**

```bash
php artisan make:migration create_categories_table
```

### 2.2 Migration Todos

**File: `database/migrations/2025_02_22_000002_create_todos_table.php`**

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('todos', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->text('description')->nullable();
            $table->boolean('completed')->default(false);
            $table->foreignId('category_id')->nullable()->constrained()->onDelete('set null');
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('todos');
    }
};
```

**Perintah untuk membuat:**

```bash
php artisan make:migration create_todos_table
```

### Jalankan Migration

```bash
php artisan migrate
```

---

## 3. MODELS - Dengan Relasi

### 3.1 Model Category

**File: `app/Models/Category.php`**

```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Category extends Model
{
    protected $fillable = ['name', 'description'];

    public function todos()
    {
        return $this->hasMany(Todo::class);
    }
}
```

**Perintah membuat:**

```bash
php artisan make:model Category
```

### 3.2 Model Todo

**File: `app/Models/Todo.php`**

```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Todo extends Model
{
    protected $fillable = ['title', 'description', 'completed', 'category_id'];

    protected $casts = [
        'completed' => 'boolean',
    ];

    public function category()
    {
        return $this->belongsTo(Category::class);
    }
}
```

**Perintah membuat:**

```bash
php artisan make:model Todo
```

---

## 4. FORM REQUESTS - Validasi Input

### 4.1 StoreCategoryRequest

**File: `app/Http/Requests/StoreCategoryRequest.php`**

```php
<?php
namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreCategoryRequest extends FormRequest
{
    public function authorize()
    {
        return true;
    }

    public function rules()
    {
        return [
            'name' => 'required|string|max:255|unique:categories,name',
            'description' => 'nullable|string',
        ];
    }
}
```

**Perintah membuat:**

```bash
php artisan make:request StoreCategoryRequest
```

### 4.2 UpdateCategoryRequest

**File: `app/Http/Requests/UpdateCategoryRequest.php`**

```php
<?php
namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class UpdateCategoryRequest extends FormRequest
{
    public function authorize()
    {
        return true;
    }

    public function rules()
    {
        return [
            'name' => 'sometimes|string|max:255|unique:categories,name,' . $this->category->id,
            'description' => 'nullable|string',
        ];
    }
}
```

### 4.3 StoreTodoRequest

**File: `app/Http/Requests/StoreTodoRequest.php`**

```php
<?php
namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreTodoRequest extends FormRequest
{
    public function authorize()
    {
        return true;
    }

    public function rules()
    {
        return [
            'title' => 'required|string|max:255',
            'description' => 'nullable|string',
            'completed' => 'nullable|boolean',
            'category_id' => 'nullable|exists:categories,id',
        ];
    }
}
```

### 4.4 UpdateTodoRequest

**File: `app/Http/Requests/UpdateTodoRequest.php`**

```php
<?php
namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class UpdateTodoRequest extends FormRequest
{
    public function authorize()
    {
        return true;
    }

    public function rules()
    {
        return [
            'title' => 'sometimes|string|max:255',
            'description' => 'nullable|string',
            'completed' => 'nullable|boolean',
            'category_id' => 'nullable|exists:categories,id',
        ];
    }
}
```

---

## 5. RESOURCES - Format Response API

### 5.1 CategoryResource

**File: `app/Http/Resources/CategoryResource.php`**

```php
<?php
namespace App\Http\Resources;

use Illuminate\Http\Resources\Json\JsonResource;

class CategoryResource extends JsonResource
{
    public function toArray($request)
    {
        return [
            'id' => $this->id,
            'name' => $this->name,
            'description' => $this->description,
            'created_at' => $this->created_at->toDateTimeString(),
            'updated_at' => $this->updated_at->toDateTimeString(),
        ];
    }
}
```

**Perintah membuat:**

```bash
php artisan make:resource CategoryResource
```

### 5.2 TodoResource

**File: `app/Http/Resources/TodoResource.php`**

```php
<?php
namespace App\Http\Resources;

use Illuminate\Http\Resources\Json\JsonResource;

class TodoResource extends JsonResource
{
    public function toArray($request)
    {
        return [
            'id' => $this->id,
            'title' => $this->title,
            'description' => $this->description,
            'completed' => (bool)$this->completed,
            'category' => new CategoryResource($this->category),
            'created_at' => $this->created_at->toDateTimeString(),
            'updated_at' => $this->updated_at->toDateTimeString(),
        ];
    }
}
```

**Perintah membuat:**

```bash
php artisan make:resource TodoResource
```

---

## 6. CONTROLLERS - Logika API

### 6.1 Struktur Folder

```bash
mkdir -p app/Http/Controllers/Api
```

### 6.2 CategoryController

**File: `app/Http/Controllers/Api/CategoryController.php`**

```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Http\Requests\StoreCategoryRequest;
use App\Http\Requests\UpdateCategoryRequest;
use App\Http\Resources\CategoryResource;
use App\Models\Category;
use Illuminate\Http\Response;

class CategoryController extends Controller
{
    public function index()
    {
        return CategoryResource::collection(Category::latest()->paginate(10));
    }

    public function store(StoreCategoryRequest $request)
    {
        $category = Category::create($request->validated());
        return new CategoryResource($category);
    }

    public function show(Category $category)
    {
        return new CategoryResource($category);
    }

    public function update(UpdateCategoryRequest $request, Category $category)
    {
        $category->update($request->validated());
        return new CategoryResource($category);
    }

    public function destroy(Category $category)
    {
        $category->delete();
        return response()->json(null, Response::HTTP_NO_CONTENT);
    }
}
```

**Perintah membuat:**

```bash
php artisan make:controller Api/CategoryController --api --model=Category
```

### 6.3 TodoController

**File: `app/Http/Controllers/Api/TodoController.php`**

```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Http\Requests\StoreTodoRequest;
use App\Http\Requests\UpdateTodoRequest;
use App\Http\Resources\TodoResource;
use App\Models\Todo;
use Illuminate\Http\Response;

class TodoController extends Controller
{
    public function index()
    {
        return TodoResource::collection(
            Todo::with('category')->latest()->paginate(10)
        );
    }

    public function store(StoreTodoRequest $request)
    {
        $todo = Todo::create($request->validated());
        return new TodoResource($todo->load('category'));
    }

    public function show(Todo $todo)
    {
        return new TodoResource($todo->load('category'));
    }

    public function update(UpdateTodoRequest $request, Todo $todo)
    {
        $todo->update($request->validated());
        return new TodoResource($todo->load('category'));
    }

    public function destroy(Todo $todo)
    {
        $todo->delete();
        return response()->json(null, Response::HTTP_NO_CONTENT);
    }
}
```

**Perintah membuat:**

```bash
php artisan make:controller Api/TodoController --api --model=Todo
```

---

## 7. ROUTES - Endpoint API

**File: `routes/api.php`**

```php
<?php
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\CategoryController;
use App\Http\Controllers\Api\TodoController;

Route::get('/user', function (Request $request) {
    return $request->user();
})->middleware('auth:sanctum');

// API Routes
Route::apiResource('categories', CategoryController::class);
Route::apiResource('todos', TodoController::class);
```

---

## 8. ENDPOINTS REFERENCE

### Categories

| Method | Endpoint | Deskripsi |
|--------|----------|-----------|
| GET | `/api/categories` | Ambil semua kategori (paginated) |
| GET | `/api/categories/{id}` | Ambil kategori berdasarkan ID |
| POST | `/api/categories` | Buat kategori baru |
| PUT | `/api/categories/{id}` | Update kategori |
| DELETE | `/api/categories/{id}` | Hapus kategori |

### Todos

| Method | Endpoint | Deskripsi |
|--------|----------|-----------|
| GET | `/api/todos` | Ambil semua todo dengan kategornya (paginated) |
| GET | `/api/todos/{id}` | Ambil todo berdasarkan ID |
| POST | `/api/todos` | Buat todo baru |
| PUT | `/api/todos/{id}` | Update todo |
| DELETE | `/api/todos/{id}` | Hapus todo |

---

## 9. CONTOH REQUEST & RESPONSE

### Create Category

**Request:**

```bash
curl -X POST http://localhost:8000/api/categories \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Work",
    "description": "Tugas pekerjaan kantor"
  }'
```

**Response (201 Created):**

```json
{
  "data": {
    "id": 1,
    "name": "Work",
    "description": "Tugas pekerjaan kantor",
    "created_at": "2026-02-22 10:30:00",
    "updated_at": "2026-02-22 10:30:00"
  }
}
```

### Create Todo

**Request:**

```bash
curl -X POST http://localhost:8000/api/todos \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Belajar Laravel API",
    "description": "Membuat CRUD API untuk Todo List",
    "completed": false,
    "category_id": 1
  }'
```

**Response (201 Created):**

```json
{
  "data": {
    "id": 1,
    "title": "Belajar Laravel API",
    "description": "Membuat CRUD API untuk Todo List",
    "completed": false,
    "category": {
      "id": 1,
      "name": "Work",
      "description": "Tugas pekerjaan kantor",
      "created_at": "2026-02-22 10:30:00",
      "updated_at": "2026-02-22 10:30:00"
    },
    "created_at": "2026-02-22 10:31:00",
    "updated_at": "2026-02-22 10:31:00"
  }
}
```

### Get All Todos

**Request:**

```bash
curl http://localhost:8000/api/todos
```

**Response (200 OK):**

```json
{
  "data": [
    {
      "id": 1,
      "title": "Belajar Laravel API",
      "description": "Membuat CRUD API untuk Todo List",
      "completed": false,
      "category": {
        "id": 1,
        "name": "Work",
        "description": "Tugas pekerjaan kantor",
        "created_at": "2026-02-22 10:30:00",
        "updated_at": "2026-02-22 10:30:00"
      },
      "created_at": "2026-02-22 10:31:00",
      "updated_at": "2026-02-22 10:31:00"
    }
  ],
  "links": {
    "first": "http://localhost:8000/api/todos?page=1",
    "last": "http://localhost:8000/api/todos?page=1",
    "prev": null,
    "next": null
  },
  "meta": {
    "current_page": 1,
    "from": 1,
    "last_page": 1,
    "path": "http://localhost:8000/api/todos",
    "per_page": 10,
    "to": 1,
    "total": 1
  }
}
```

### Update Todo

**Request:**

```bash
curl -X PUT http://localhost:8000/api/todos/1 \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Belajar Laravel API - COMPLETED",
    "completed": true
  }'
```

### Delete Todo

**Request:**

```bash
curl -X DELETE http://localhost:8000/api/todos/1
```

**Response (204 No Content):**

```
[empty body]
```

---

## 10. POSTMAN COLLECTION

### Import ke Postman

1. Buka **Postman**
2. Klik **Import** â†’ **Raw Text**
3. Copy-paste JSON berikut
4. Klik **Import**

### JSON Collection

```json
{
  "info": {
    "_postman_id": "todo-api-collection",
    "name": "Todo API CRUD",
    "description": "Complete CRUD API untuk Todo List dengan Kategori",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Categories",
      "item": [
        {
          "name": "Get All Categories",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/categories",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "categories"]
            },
            "description": "Ambil semua kategori"
          },
          "response": []
        },
        {
          "name": "Get Category By ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/categories/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "categories", "1"]
            },
            "description": "Ambil kategori berdasarkan ID"
          },
          "response": []
        },
        {
          "name": "Create Category",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Work\",\n  \"description\": \"Tugas pekerjaan kantor\"\n}"
            },
            "url": {
              "raw": "http://localhost:8000/api/categories",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "categories"]
            },
            "description": "Buat kategori baru"
          },
          "response": []
        },
        {
          "name": "Update Category",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Personal\",\n  \"description\": \"Tugas pribadi\"\n}"
            },
            "url": {
              "raw": "http://localhost:8000/api/categories/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "categories", "1"]
            },
            "description": "Update kategori tertentu"
          },
          "response": []
        },
        {
          "name": "Delete Category",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/categories/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "categories", "1"]
            },
            "description": "Hapus kategori"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Todos",
      "item": [
        {
          "name": "Get All Todos",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/todos",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "todos"]
            },
            "description": "Ambil semua todo dengan kategorinya"
          },
          "response": []
        },
        {
          "name": "Get Todo By ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/todos/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "todos", "1"]
            },
            "description": "Ambil todo berdasarkan ID"
          },
          "response": []
        },
        {
          "name": "Create Todo",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Belajar Laravel API\",\n  \"description\": \"Membuat CRUD API untuk Todo List\",\n  \"completed\": false,\n  \"category_id\": 1\n}"
            },
            "url": {
              "raw": "http://localhost:8000/api/todos",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "todos"]
            },
            "description": "Buat todo baru"
          },
          "response": []
        },
        {
          "name": "Update Todo",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Belajar Laravel API (Updated)\",\n  \"description\": \"Membuat CRUD API untuk Todo List dengan kategori\",\n  \"completed\": true,\n  \"category_id\": 1\n}"
            },
            "url": {
              "raw": "http://localhost:8000/api/todos/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "todos", "1"]
            },
            "description": "Update todo tertentu"
          },
          "response": []
        },
        {
          "name": "Delete Todo",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "http://localhost:8000/api/todos/1",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8000",
              "path": ["api", "todos", "1"]
            },
            "description": "Hapus todo"
          },
          "response": []
        }
      ]
    }
  ]
}
```

---

## 11. JALANKAN SERVER

```bash
php artisan serve
```

Server akan berjalan di `http://localhost:8000`

---

## 12. TIPS & BEST PRACTICES

âœ… **Eager Loading** - Hindari N+1 query problem:
```php
Todo::with('category')->latest()->paginate(10)
```

âœ… **Validasi Input** - Gunakan Form Request classes untuk validasi terpusat.

âœ… **Soft Delete** - Untuk keamanan data, gunakan soft delete pada model.

âœ… **Authentication** - Tambahkan Laravel Sanctum atau JWT untuk secure API.

âœ… **Error Handling** - Gunakan exception handler untuk error responses yang konsisten.

âœ… **Testing** - Buat unit dan feature tests untuk memastikan API berfungsi dengan baik.

---

## 13. TROUBLESHOOTING

### Error: "Unauthenticated"
Jika muncul error 401, berarti middleware authentication aktif. Untuk testing, comentarkan atau tambahkan token.

### Error: "Column not found"
Pastikan `php artisan migrate` sudah dijalankan dan tidak ada error.

### Error: "Integrity constraint violation"
Periksa urutan migration. Category harus dibuat sebelum Todo.

### N+1 Query Problem
Gunakan `with('category')` saat query Todo untuk eager loading.

---

Materi lengkap siap untuk dikerjakan! ðŸš€
